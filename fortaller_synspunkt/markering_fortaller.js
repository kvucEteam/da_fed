/// DATA ARRAYS: 
var textdata_opg1_Array = [
    ["I den store stad, hvor han boede, gik det meget fornøjeligt til, hver dag kom der mange fremmede, en dag kom der to bedragere; de gav sig ud for at være vævere og sagde, at de forstod at væve det dejligste tøj, man kunne tænke sig.", "ydre"],
    ["Ikke alene farverne og mønstret var noget usædvanligt smukt, men de klæder, som blev syet af tøjet, havde den forunderlige egenskab at de blev usynlige for ethvert menneske, som ikke duede i sit embede, eller også var utilladelig dum.", "ydre"],
    ["'Det var jo nogle dejlige klæder,' tænkte kejseren 'ved at have dem på, kunne jeg komme efter, hvilke mænd i mit rige der ikke dur til det embede de har, jeg kan kende de kloge fra de dumme! ja det tøj må straks væves til mig!'", "indre"],
    ["og han gav de to bedragere mange penge på hånden, for at de skulle begynde på deres arbejde. ", "ydre"],
    ["De satte også to vævestole op, lod som om de arbejdede, men de havde ikke det mindste på væven. Rask væk forlangte de den fineste silke, og det prægtigste guld; det puttede de i deres egen pose og arbejdede med de tomme væve, og det til langt ud på natten.", "ydre"],
    ["'Nu gad jeg dog nok vide, hvor vidt de er med tøjet!' tænkte kejseren, men han var ordentligt lidt underlig om hjertet ved at tænke på, at den, som var dum, eller slet passede til sit embede,", "indre"],
    ["ikke kunne se det, nu troede han nok, at han ikke behøvede at være bange for sig selv, men han ville dog sende nogen først for at se, hvorledes det stod sig.", "indre"],
    ["Alle mennesker i hele byen vidste, hvilken forunderlig kraft tøjet havde, og alle var begærlige efter at se, hvor dårlig eller dum hans nabo var.", "indre"],
    ["'Jeg vil sende min gamle ærlige minister hen til væverne!', tænkte kejseren, 'han kan bedst se, hvorledes tøjet tager sig ud, for han har forstand, og ingen passer sit embede bedre end han!'", "indre"],
    ["Nu gik den gamle skikkelige minister ind i salen, hvor de to bedragere sad og arbejdede med de tomme væve.", "ydre"],
    ["'Gudbevares!' tænkte den gamle minister", "indre"],
    ["og spilede øjnene op!", "ydre"],
    ["jeg kan jo ikke se noget!", "indre"],
    ["Men det sagde han ikke.", "ydre"],
    ["Begge bedragerne bad ham være så god at træde nærmere og spurgte, om det ikke var et smukt mønster og dejlige farver. Så pegede de på den tomme væv, og den stakkels gamle minister blev ved at spile øjnene op, men han kunne ikke se noget, for der var ingen ting.", "ydre"],
    ["'Herregud!' tænkte han, 'skulle jeg være dum! Det har jeg aldrig troet, og det må ingen mennesker vide! Skulle jeg ikke du til mit embede? Nej det går ikke an, at jeg fortæller, jeg ikke kan se tøjet!'", "indre"]
];
var textdata_opg2_Array = [
    ["Jørgen Haagensen sad med telefonen", "ydre"],
    ["og skammede sig over at han ikke anede hvad han skulle gøre, hvem man snakkede med og osse over sit forehavende.", "indre"],
    ["Han formulerede sig uklart og blev sendt de forkerte steder hen.", "ydre"],
    ["'Det er Jørgen Haagensen igen,'", "false"],
    ["sagde han til en dame, han allerede havde haft fat på én gang.", "ydre"],
    ["'Ja?'", "false"],
    ["Inger rodede med bøjlerne i entreen, tandlægebesøgene var dukket op igen, hun tog hele tiden frakke på for at komme af sted, blev forvirret over at døren var låst og kom ind i stuen og sværmede om ham.", "ydre"],
    ["'Kan de tale lidt højere,'", "false"],
    ["bad damen.", "ydre"],
    ["'Det drejer sig om en plejehjemsplads,'", "false"],
    ["'Vil de tale med Plejehjemsadministrationen eller med Hjemmeplejefunktionen?'<br/>'Det ved jeg ikke,' ", "false"],
    ["sagde han ulykkeligt.", "ydre"],
    ["'Hvad er problemet?'", "false"],
    ["Heldigvis var hun venlig.", "indre"],
    ["'Det er min kone,'", "false"],
    ["sagde han", "ydre"],
    ["og kunne ikke komme det nærmere, kunne simpelthen ikke.", "indre"],
    ["Inger prøvede med fagter at forklare at døren var låst.", "ydre"],
    ["'Så skal de ringe til det socialcenter De hører under,'", "false"],
    ["sagde damen.", "ydre"],
    ["'Tak,'", "false"],
    ["sagde han.", "ydre"]
];
var textdata_opg3_Array = [
    ["På Nørreport lå drengens fortand stadig på trappeafsatsen, og hvis ikke det havde været for en meget tænksom ung pige med hovedtelefoner, der kom forbi, ville den sikkert være blevet fejet væk som affald.", "ydre"],
    ["Men nu fik hun øje på tanden under et stykke slikpapir og bukkede sig ned efter den.", "ydre"],
    ["Hun undersøgte den og blev enig med sig selv om, at det måtte være et stykke plastic.", "indre"],
    ["Hun stoppede op og stod og lyttede lidt.", "ydre"],
    ["Så mærkede hun sin rotte kravle ud på hendes ene skulder og gik videre.", "indre"],
    ["Mens hun stod og købte en pakke cigaretter i en af kioskerne, lod hun tanden glide ud af hånden, så den faldt ned på fliserne og kom til at ligge og skinne i efterårssolen.", "false"],
    ["Senere var der et par visne blade, der lagde sig omkring den, så den om til at ligge og lyse som en hvid sten i en fatning.", "ydre"],
    ["De to veninder, der havde drukket kaffe ved Storkespringvandet, havde efterhånden brugt mange penge", "indre"],
    ["og følte, at de havde arbejdet hårdt. De besluttede sig for at gå op mod Nørreport.", "indre"],
    ["Drengens søster var på vej ned ad Købmagergade, hvor hun krydsede de to veninder, der styrede mod Nørreport. Bitten tog sit røde uldtørklæde på.", "indre"],
    ["Hun spejlede sig i et butiksvindue og var ganske godt tilfreds med det, hun så.", "indre"],
    ["Faktisk var hun så tilfreds, at hun sendte sig selv et lille smil.", "indre"],
    ["Drengens søster misforstod situationen og smilede tilbage. Bredt og tandløst.", "indre"],
    ["Da de to veninder kom op til Nørreport, så de en dreng komme vaklende hen mod kioskerne,", "ydre"],
    ["de kunne ikke rigtig beslutte sig for, om de skulle hjælpe ham.", "indre"],
    ["Men til sidst gav de ham en hjælpende hånd,", "ydre"],
    ["og Bitten genkendte ham som drengen, der tidligere havde siddet på stentrappen.", "indre"],
    ["'Jeg leder efter min tand', mumlede han.", "false"],
    ["De to veninder kiggede på hinanden og rystede på hovedet. En af pigerne fra kiosken kiggede ud.", "false"],
    ["'Blev du ikke hentet i en ambulance tidligere i dag?'", "ydre"],
    ["'Nej'", "false"],
    [", sagde drengen.", "ydre"],
    ["'Det var ikke mig. Jeg har bare tabt min tand'", "false"]
];
var textdata_opgaver_Array = Array(textdata_opg1_Array, textdata_opg2_Array, textdata_opg3_Array);
var fortaeller_Array = Array("Personal", "Vekslende", "Alvidende");
var forfatter_Array = Array("Uddrag fra <b>Kejserens nye klæder</b> (1837) af H.C. Andersen", "Uddrag fra <b>Vægten</b> (1996) af Kim Fupz Aakeson.", "Uddrag fra <b>Nørreport</b> (2004) af Katrine Marie Guldager");

var selected_fortaeller = "none";
var fejl = 0;
var fejl_bool = false;
var score = 0;
var correct_words = 0;
var runde = 0;
// INITIER LORTET:
$(document).ready(function() {
    $(".btn_fortaeller").click(function() {
        $(".btn_fortaeller").removeClass("selected_class");
        selected_fortaeller = $(this).html();
        // alert(selected_fortaeller);
        $(this).addClass("selected_class");
        tjek_svar("btn");
    });

    $(".btn_help").click(function() {
        alertBox("Hjælp", "Klik på en sætning i teksten. Beslut dig for om det er indre eller ydre synsvinkel der er i sætningen. Tælleren under tekst-uddraget viser dig, hvor mange sætninger du mangler at få rigtigt. Klik på knappen og vælg mellem de forskellige fortællertyper.");
    });


    for (var p = 0; p < textdata_opgaver_Array.length; p++) {
        $(".prikker").append("<div class='prik'><img src='prik_grey.png'></div>")
    }
    init();
    start_pop_up(0);
});

function init() {
    //alert(textdata_opg1_Array.length);
    // RUNDE 1:
    //alert ("init: " + runde);
    $(".text_container").html("");
    correct_words = 0;
    fejl = 0;
    score = 0;
    var forfattertxt = forfatter_Array[runde];
    $(".byline").html(forfattertxt);

    for (var i = 0; i < textdata_opgaver_Array[runde].length; i++) {
        //console.log(textdata_opg2_Array[i][0]);
        //Hent tekst fra Array ind i html'eren:
        if (textdata_opgaver_Array[runde][i][1] == "false") {
            $(".text_container").append("<span class='sentence false'>" + textdata_opgaver_Array[runde][i][0] + "</span> ");
        } else {
            $(".text_container").append("<span class='sentence'>" + textdata_opgaver_Array[runde][i][0] + "</span> ");
            correct_words++;
        }
    }
    $(".sentence").click(function(e) {
        $(".sentence").removeClass("selected_text");
        if (!$(this).hasClass("false") && !$(this).hasClass("correct")) {
            $(this).addClass("selected_text");
            $(".pop_up_select").remove();
            var number = $(this).index();
            pop_up_select(e, number);
            //$(".correct_words").html($(".correct").length + " ud af " + $(".correct_word").length + " rigtige ord................... (fejl: " + fejl + ")");
        } else if ($(this).hasClass("false")) {
            alertBox("Sætningen indgår ikke i opgaven", "Du har klikket på en dialog. Dialogiske sætninger fortæller ikke noget om ydre eller indre synsvinkel.");
        }
    });
    $(".sentence").css("cursor", "pointer");
    $(".correct_words").html("<b>Du har " + score + " ud af " + correct_words + " rigtige </b><br/><em>(Du har klikket forkert " + fejl + " gange)</em>");
    $(".prik").eq(runde).html("<img src='prik_lilla.png'>");
    $(".tekst").html("Tekst " + (runde + 1));
    //alert("init end")
}

function tjek_svar(input, number) {
    //alert($(".sentence").length);
    //alert("nummer: " + input);
    if (!$(".sentence").eq(number).hasClass("correct")) {
        if ($(".sentence").eq(number).hasClass("ydre") && textdata_opgaver_Array[runde][number][1] == "ydre") {
            score++;
            //alert ("score");
            $(".sentence").eq(number).addClass("correct");
            $(".correct_words").html("<b>Du har " + score + " ud af " + correct_words + " rigtige </b><br/><em>(Du har klikket forkert " + fejl + " gange)</em>");
        } else if ($(".sentence").eq(number).hasClass("indre") && textdata_opgaver_Array[runde][number][1] == "indre") {
            score++;
            $(".sentence").eq(number).addClass("correct");
            $(".correct_words").html("<b>Du har " + score + " ud af " + correct_words + " rigtige </b><br/><em>(Du har klikket forkert " + fejl + " gange)</em>");
            //return ("ud");
        } else {
            $(".sentence").eq(number).fadeTo("slow", 0.5, function() {
                $(".sentence").eq(number).fadeTo("slow", 1);
                $(".sentence").eq(number).removeClass("ydre");
                $(".sentence").eq(number).removeClass("indre");
                // Animation complete.
            });
            if (input != "btn") {
                fejl++
            };
            wrong_answer("Ikke helt rigtigt", "Vurdér sætningen igen: <br/><b>'" + $(".sentence").eq(number).html() + "'</b>");
        }
        //}
    }
    $(".correct_words").html("<b>Du har " + score + " ud af " + correct_words + " rigtige </b><br/><em>(Du har klikket forkert " + fejl + " gange)</em>");
    //alert ("opdater score");
    if (score >= correct_words && selected_fortaeller == fortaeller_Array[runde]) {
        if (runde < textdata_opgaver_Array.length - 1) {
            runde++;
            alertBox("Rigtigt!", "Du har fundet alle de ord, der identificerer fortælleren, samt fundet den rigtige fortæller. <br/>Gå videre til næste opgave.")
            init();
        } else {
            runde = 0;
            alertBox("SUPER", "Du lavet alle opgaverne korrekt! <br>Du lavede <b>" + fejl + " fejl </b>undervejs");
        }
    } else if (input == "btn" && selected_fortaeller == fortaeller_Array[runde]) {
        //alert("score" + score + " cw: " + correct_words);
        alertBox("Rigtig fortæller", "Du har valgt rigtigt med hvilken fortællertype det er, men du mangler stadig at bestemme hvilke sætninger der er ydre og indre før du kan gå videre.");
    } else if (input == "btn" && selected_fortaeller != fortaeller_Array[runde]) {
    

        alertBox("Forkert fortæller", "Du har valgt den forkerte fortællertype.<br/>");
    } else if (input == "sentence" && score >= correct_words && selected_fortaeller != fortaeller_Array[runde]) {
        alertBox("Rigtigt!", "Alle sætninger er korrekte.<br/>Nu mangler du bare at vælge hvilken fortællertype det er.");
    } else {
        console.log("no avail..");
    }
    //if (score >= correct_words && )
}

function pop_up_select(e, number) {
    $('.pop_up_select').remove();
    //alert (e.index());
    var parentOffset = $(".container").offset();
    var relX = e.pageX - parentOffset.left;
    if (relX < 86) {relX = 86}
    var relY = e.pageY - parentOffset.top;
    $(".container").append($("<div class='pop_up_select'><div class='arrow_up'></div><div class='lex'>Vælg synsvinkel</div><div class='ydre_select'>Ydre</div><div class='indre_select'>Indre</div><br></div>").css({
        left: relX - 17,
        top: relY + 60
    }));
    $(".pop_up_select").draggable({containment: ".text_container" });
    $(".pop_up_select").click(function(e) {
        //alert("number:  " + number);
        var classString = e.target.className;
        if (classString == "ydre_select") {
   
            $(".sentence").eq(number).removeClass("indre");
            $(".sentence").eq(number).addClass("ydre");
        } else if (classString == "indre_select") {
            $(".sentence").eq(number).removeClass("ydre");
            $(".sentence").eq(number).addClass("indre");
        }
        $('.pop_up_select').remove();
        $(".sentence").removeClass("selected_text");
        tjek_svar("sentence", number);
    });
}

function pop_up_remove() {
    $('.pop_up_select').remove();
}

function start_pop_up(number) {
    $(".sentence").eq(0).addClass("selected_text");
    $('.pop_up_select').remove();
    $(".container").append($("<div class='pop_up_select'><div class='arrow_up'></div><div class='lex'>Vælg synsvinkel</div><div class='ydre_select'>Ydre</div><div class='indre_select'>Indre</div><br></div>").css({
        left: 214,
        top: 351
    }));
    
    $(".pop_up_select").draggable({containment: ".text_container" });
    $(".pop_up_select").click(function(e) {
        //alert("number:  " + number);
        var classString = e.target.className;
        if (classString == "ydre_select") {
            $(".sentence").eq(number).removeClass("indre");
            $(".sentence").eq(number).addClass("ydre");
        } else if (classString == "indre_select") {
            $(".sentence").eq(number).removeClass("ydre");
            $(".sentence").eq(number).addClass("indre");
        }
        $('.pop_up_select').remove();
        $(".sentence").removeClass("selected_text");
        tjek_svar("sentence", number);
    });
}
